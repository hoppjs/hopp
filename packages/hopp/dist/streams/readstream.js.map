{"version":3,"sources":["../../src/streams/readstream.js"],"names":["file","dest","root","size","emitted","createReadStream","body","next","undefined","length","Error","done"],"mappings":";;;;;;;;AAMA;;;;AACA;;;;AACA;;;;AACA;;;;AATA;;;;;;kBAWe,CAACA,IAAD,EAAOC,IAAP,EAAaC,IAAb,KAAsB;AACnC,MAAIC,IAAJ;AACA,MAAIC,UAAU,CAAd;;AAEA,SAAO,oBACL,aAAGC,gBAAH,CAAoBL,IAApB,CADK,EAEL;AAAA,wCAAI,WAAOM,IAAP,EAAaC,IAAb,EAAsB;AACxB,UAAIJ,SAASK,SAAb,EAAwB;AACtBL,eAAO,CAAC,6BAAM,eAAKH,IAAL,CAAN,CAAD,EAAmBG,IAA1B;AACD;;AAED;AACAC,iBAAWE,KAAKG,MAAhB;;AAEA;AACA,UAAIL,UAAUD,IAAd,EAAoB;AAClB,eAAOI,KAAK,IAAIG,KAAJ,CAAU,iDAAV,CAAL,CAAP;AACD;;AAEDH,WAAK,IAAL,EAAW;AACT;AACAL,YAFS;AAGTF,YAHS;AAITC,YAJS;AAKTE,YALS;AAMTQ,cAAMP,YAAYD,IANT;;AAQT;AACAG;AATS,OAAX;AAWD,KAxBD;;AAAA;AAAA;AAAA;AAAA,OAFK,CAAP;AA4BD,C","file":"../../src/streams/readstream.js","sourcesContent":["/**\n * @file src/tasks/read-stream.js\n * @license MIT\n * @copyright 2017 10244872 Canada Inc.\n */\n\nimport fs from 'fs'\nimport pump from 'pump'\nimport map from './map'\nimport { stat } from '../fs'\n\nexport default (file, dest, root) => {\n  let size\n  let emitted = 0\n\n  return pump(\n    fs.createReadStream(file),\n    map(async (body, next) => {\n      if (size === undefined) {\n        size = (await stat(file)).size\n      }\n\n      // collect size\n      emitted += body.length\n\n      // check for unexpected values\n      if (emitted > size) {\n        return next(new Error('File size received exceeded expected file size.'))\n      }\n\n      next(null, {\n        // metadata\n        root,\n        file,\n        dest,\n        size,\n        done: emitted === size,\n\n        // contents\n        body\n      })\n    })\n  )\n}\n"]}